<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webcam Display Stream</title>
    <link rel="stylesheet" href="styles/index.css">
    <script type="module" src="AI-handling.js"></script>
</head>
<body>
    <div id="container">
        <video autoplay="true" id="videoElement"></video>
        <canvas id="canvasElement"> </canvas>
    </div>

    <button class="scan-button" id="scanBtn">Scan</button>
    <div id="result"></div>

    <script type="module">
        import { findBin } from './AI-handling.js';
        
        // Initialize variables
    const resultDiv = document.getElementById('result');
    let video = document.querySelector("#videoElement");
    const canvas = document.getElementById('canvasElement');
    const scanBtn = document.getElementById('scanBtn');

    scanBtn.addEventListener('click', handleScan);

        if(navigator.mediaDevices.getUserMedia){ //if the user media is supported
            navigator.mediaDevices.getUserMedia({ video:true }) //
            .then(function(stream){
                video.srcObject = stream;
                // allow inline playback on some mobile browsers
                video.playsInline = true;
                // update visual state when controls change
                function horizontalFlip(){
                    video.style.transform = `scaleX(${-1}) scaleY(${1})`;
                }
                horizontalFlip();
            })
            .catch (function(error){
                console.log("Something went wrong!");
            })
        }else{
            console.log("getUserMedia not supported on your browser!");
        }
    function handleScan(){
        const ctx = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        console.log("Scan Worked! I hope!")
 
        //convert the canvas to a Base64 String
        const fullDataURL = canvas.toDataURL('image/jpeg');
        const imageBase64 = fullDataURL.split(',')[1];
        // MIME type specifies the file format (PNG image in this case)
        const mimeType = 'image/jpeg';

        findBin(imageBase64, mimeType, resultDiv, displayResults);
    }
    function displayResults(result) {
        if (resultDiv) {
            resultDiv.innerHTML = `
                <h2>Results:</h2>
                <p><strong>Object:</strong> ${result.object_identified}</p>
                <p><strong>Bin:</strong> ${result.bin_destination}</p>
                <p><strong>Reasoning:</strong> ${result.reasoning}</p>
            `;
        }
    }
</script>
</body>
</html>