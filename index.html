<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webcam Display Stream</title>
    <link rel="stylesheet" href="styles/index.css">
    <link rel="stylesheet" href="styles/garbage-bins.css">
    <script type="module" src="AI-handling.js"></script>
</head>
<body>
    <video id="backgroundVideo" autoplay loop muted playsinline>
        <source src="images/paperCrumble.mp4" type="video/mp4">
    </video>
    <div class="camera-section">
        <div id="container">
            <video autoplay="true" id="videoElement"></video>
            <canvas id="canvasElement" style="display: none;"> </canvas>
        </div>
        <div class="scan-button-container">
            <div class="scan-button" id="scan-button"><span>SCAN</span></div>
        </div>
    </div>

    <div id="bins-container" class="bins-container">
        <div class="recycling-bin-container">
            <img id="closed-recycling-bin" class="closed-recycling-bin" src="images/recyclebinClosed.png" alt="Recycling Bin" />
            <img id="open-recycling-bin" class="open-recycling-bin disappear" src="images/recyclebinOPen.png" alt="Recycling Bin" />
        </div>
        <div class="garbage-bin-container">
            <img id="closed-garbage-bin" class="closed-garbage-bin" src="images/garbagebinClosed.png" alt="Garbage Bin" />
            <img id="open-garbage-bin" class="open-garbage-bin disappear" src="images/garbagebinOpen.png" alt="Garbage Bin" />
        </div>
        <div class="green-bin-container">
            <img id="closed-green-bin" class="closed-green-bin" src="images/greenbinClosed.png" alt="Green Bin" />
            <img id="open-green-bin" class="open-green-bin disappear"  src="images/greenbinOpen.png" alt="Green Bin" />
        </div>
    </div>

    <div id="result"></div>

    <script type="module">
        import { findBin } from './AI-handling.js';
        import {openTheBins, closeTheBins} from './garbage-bins.js';
        
        // Initialize variables
    const resultDiv = document.getElementById('result');
    let video = document.querySelector("#videoElement");
    const canvas = document.getElementById('canvasElement');
    const scanBtn = document.getElementById('scan-button');

    scanBtn.addEventListener('click', handleScan);

        if(navigator.mediaDevices.getUserMedia){ //if the user media is supported
            navigator.mediaDevices.getUserMedia({ video:true }) //
            .then(function(stream){
                video.srcObject = stream;
                // allow inline playback on some mobile browsers
                video.playsInline = true;
                // update visual state when controls change
                function horizontalFlip(){
                    video.style.transform = `scaleX(${-1}) scaleY(${1})`;
                }
                horizontalFlip();
            })
            .catch (function(error){
                console.log("Something went wrong!");
            })
        }else{
            console.log("getUserMedia not supported on your browser!");
        }
    function handleScan(){
        openTheBins();
        setTimeout(() => {
            closeTheBins();
        }, 2000);
        // const ctx = canvas.getContext('2d');
        // canvas.width = video.videoWidth;
        // canvas.height = video.videoHeight;
        // ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
 
        // //convert the canvas to a Base64 String
        // const fullDataURL = canvas.toDataURL('image/jpeg');
        // const imageBase64 = fullDataURL.split(',')[1];
        // // MIME type specifies the file format (PNG image in this case)
        // const mimeType = 'image/jpeg';

        // findBin(imageBase64, mimeType, resultDiv, displayResults);
    }
    function displayResults(result) {
        if (resultDiv) {
            resultDiv.innerHTML = `
                <h2>Results:</h2>
                <p><strong>Object:</strong> ${result.object_identified}</p>
                <p><strong>Bin:</strong> ${result.bin_destination}</p>
                <p><strong>Reasoning:</strong> ${result.reasoning}</p>
            `;
        }
    }
</script>
</body>
</html>